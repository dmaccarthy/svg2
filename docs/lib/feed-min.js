const css=SVG2.style;function clearFeed(){if($("body").hasClass("Present"))return location.reload();loadFeed.data={};for(let e of loadFeed._inits)delete loadFeed[e];return loadFeed._inits=[],$("div.Message").remove(),$("#Main").html("")}function loadFeed(e,t){if(clearTimeout(loadFeed.refresh),loadFeed.referer=loadFeed.current,null==e)e=loadFeed.current;else if("string"!=typeof e){let t=$(e).attr("data-id").toLowerCase();if(t="today"==t?loadFeed.current.split("/")[0]+"/cal":loadFeed.data[t],!t)return;e=t}loadFeed.data.folder&&(e=e.replace("$",loadFeed.data.folder)),loadFeed.opener=loadFeed.current,loadFeed.cache[e]?onFeedLoaded(e,!0,t):fetch(e+".htm",{cache:"reload"}).then((a=>{a.text().then((o=>{a.ok||(o=loadFeed.error(a,e)),onFeedLoaded(e,o,t),a.ok||msg()}))}),(a=>{let o=loadFeed.error(a,e);onFeedLoaded(e,o,t),msg()})),loadFeed.refresh=setTimeout((()=>{location.reload()}),144e5)}function feedURL(e,t){let a="";if(!0===t&&(t=qs_args()),t&&t.length){let e;for(e in a="?",t)a.length>1&&(a+="&"),a+=`${encodeURIComponent(e)}=${encodeURIComponent(t[e])}`}return location.origin+location.pathname+`${a}#${e}`}function mediaURL(e){if(-1!=e.indexOf("/"))return e;if("http"==e.slice(0,4))return e;if("$"==e.charAt(0))return data_images[e.substring(1)];let t=mediaURL.urls[e],a=e.indexOf(".")>-1;return t||`./media/${e}`+(a?"":".png")}function apply(e,t){$.each($(e),((e,a)=>{t($(a))}))}loadFeed.error=(e,t)=>(console.warn(e),`<section class="Post">\n        <h2 class="FeedLink">${e.status} â€” ${e.statusText}</h2>\n        <p>${t}</p>\n        <p class="Center"><span class="Link" onclick="history.back()">Back</span> | <span class="Link" onclick="loadFeed('home')">Home</span></p>\n        <script type="text/javascript">loadFeed.data = {title: 'Error'}<\/script>\n    </section>`),loadFeed.cache={},loadFeed._inits=[],mediaURL.urls={};let teacher=()=>{};function onFeedLoaded(e,t,a){let o=loadFeed.cache;if(!0===t&&o)t=loadFeed.cache[e];else if(o[e]=t,teacher.mode){let e,t=0,a=0;for(e in o)a+=o[e].length,t++;console.log(`Cache: ${t} feed(s) [${(a/1024).toFixed(1)} kb]`)}null==collapse.toggled[e]&&(collapse.toggled[e]=[]),loadFeed.current=e;let d,l,n,i=location.hash;if(i.slice(1)!=e&&!a){let t=feedURL(e,!0);i?history.pushState({},"",t):history.replaceState({},"",t)}$("#Main").css("visibility","hidden"),clearFeed().prepend(t);try{loadFeed.data=process_loadData(e)}catch(e){loadFeed.data=Object.assign({up:"home"},loadFeed.data)}try{handouts(loadFeed.data.handouts),calendar(loadFeed.data.cal)}catch(e){}teacher.mode||(apply("[data-answers]",(e=>{let t=e.attr("data-answers");"1"==t&&(t=loadFeed.data.answerDate),is_after(t)||e.find(".Answer").remove()})),apply("[data-show]",(e=>{let t=e.attr("data-show");"1"==t&&(t=loadFeed.data.showDate),is_after(t)||e.remove()}))),apply("section.Post[data-title]",(e=>{e.prepend($("<h2>").html(e.attr("data-title")))})),apply("button[data-icon]",(e=>{e.html($("<p>").html(e.html()))})),apply("[data-icon]",(e=>{let t={src:mediaURL(e.attr("data-icon"))};e.prepend($("<img>").attr(t).addClass("Icon"))})),printIcons(),apply("img[data-src]",(e=>{e.attr({src:mediaURL(e.attr("data-src"))})}));try{apply("[data-yt], [data-video]",video)}catch(e){}let s=$("section.Post").find(".Collapse:not(div)");s.addClass("Link").on("click",collapse).attr({title:"Click to expand or collapse"}),$("section.Post > img.Icon:first-child").click((e=>{$(e.currentTarget).next().trigger("click")})).addClass("Link");let r=loadFeed.data;l=r.title,l||(l="Untitled Feed"),document.title=$("<p>").html(r.title).text(),s=$("#TopTitle").html(l),r.up?s.addClass("FeedLink").attr({title:"Click to go up one level"}):s.removeClass("FeedLink").removeAttr("title"),apply(".Var",(e=>{let t=e.html();t=r[t]?r[t]:siteData[t],e.html(t)}));let c=["prev","next"];window.calendar&&c.splice(0,0,"today");let p=-1;for(d=$("#Buttons > a").removeClass("Last"),n=0;n<c.length;n++)r[c[n]]?($(d[n]).show(),p=n):$(d[n]).hide();p>-1&&$(d[p]).addClass("Last"),apply("[data-feed]",(e=>{let t=e[0].tagName,a=e.attr("data-feed");if("A"==t){let t=r.folder;t=feedURL(t?a.replace("$",t):a,!0),e.attr({href:t}).click(clickLink)}else"SECTION"==t&&(e=$(e.find("h2")[0])),e.addClass("FeedLink").attr({title:"Click to open this feed"}).click((()=>{loadFeed(a)}))})),apply("[data-gdrv], [data-gdoc], [data-doc], [data-link], [data-open]",(e=>{let t=e.attr("data-link"),a=!1;t||(a=!0,t=e.attr("data-gdrv"),t?t="https://drive.google.com/file/d/"+t:(t=e.attr("data-gdoc"),t?t="https://docs.google.com/document/d/"+t:(t=e.attr("data-doc"),t=t?"media/"+t:e.attr("data-open")))),"A"==e[0].tagName?(e.attr({href:t}),a&&e.attr({target:random_string(12,2)})):e.addClass("FeedLink").click((()=>{a?window.open(t):location.href=t}))})),$(".IO").removeClass("IO").addClass("Code"),$("pre.Code, pre.CodeScroll").attr({spellcheck:!1}),$("[data-echo=copy]").attr("data-echo","text"),apply("[data-echo]",copy_or_open),$("#Top").remove().appendTo("body").show(),$("#Buttons > a").on("click",(e=>{loadFeed(e.currentTarget)})),setTimeout((()=>$("div:is(.MJX_ToolTip, .MJX_LiveRegion, .MJX_HoverRegion)").remove()),2e3),$("tr.NoBold th:not(.Bold)").addClass("NoBold"),$("#Main, #Copy").show(),drawChevrons(),renderTeX(),SVG2.load(initFeed)}function printIcons(){for(let e of $("section.Post:not(.NoPrintIcon)"))if(e=$(e).children("h2:not(.NoPrintIcon)"),e.length){e=$(e[0]),e.children("span[data-print]").remove();let t=$("<span>").addClass("Action");e.append(t),$("<img>").attr({"data-src":"$print",title:"Print this section"}).appendTo(t).on("click",(t=>($("section.Post").hide(),e.closest("section.Post").show(),$(t.currentTarget).closest("h2").next("div.Collapse").show().find(".Collapse").show(),print(),!1)))}}function initFeed(){$("._Present").removeClass("_Present").addClass("Present");for(let e of $("script[data-init]")){let t=$(e).attr("data-init");try{loadFeed[t]()}catch(e){console.error(e)}loadFeed._inits.push(t)}$("section.Post div.Collapse:not(.Expand)").hide();let e=$("div.Collapse"),t=collapse.toggled[loadFeed.current];for(let a of t)$(e[a]).toggle();$("#Main").css("visibility","visible"),layoutWidth(),$(window).scrollTop(0)}function copy_or_open(e){let t=e.attr("data-echo"),a=$("<p>").addClass("EchoControl").insertBefore(e),o=e.attr("data-title");"1"==o&&(o=t),t=t.split("."),t=t[t.length-1],o||(o={html:"HTML Code",htm:"HTML Code",xml:"XML Code",py:"Python Code",text:"Plain Text",css:"CSS Code",js:"Javascript Code",json:"JSON Data",svg:"SVG Code",csv:"CSV Data",io:"Program Output"}[t]),o||(o="Plain Text"),a.html($("<span>").html(o).addClass("CodeTitle"));let d=$("<span>").addClass("Buttons").appendTo(a),l=["copy","open_tab","download"];for(i=0;i<3;i++)btn=$("<img>").addClass("Icon").attr({src:data_images[l[i]],alt:l[i],title:["Copy to clipboard","Open in new browser tab","Download"][i]}).appendTo(d),btn[0].action=i,btn.click((e=>{e=e.currentTarget,code_echo($(e).closest(".EchoControl").next("[data-echo]"),e.action)}))}function drawChevrons(){let e=$("div.Collapse");for(let t=0;t<e.length;t++){let a=$(e[t]),o=a.prev(".Collapse");if(0==o.find(".Chevron").length)for(let e of"dr")o.prepend($("<img>").addClass("Chevron").attr({src:data_images[`chevron_${e}`]}));let d=a.is(":visible")?0:1;a=o.find(".Chevron"),$(a[d]).hide(),$(a[1-d]).show()}}function clickLink(e){let t=location.origin+location.pathname,a=$(e.currentTarget).attr("href"),o=t.length;if(a.slice(0,o)==t){return loadFeed(a.slice(o+1)),!1}}function goUp(e){let t=loadFeed.data.up;t&&loadFeed(t)}function layoutWidth(){let e=$("body"),t=e.width(),a=($(window).width()-t)/2,o=$("#Top"),d=e.hasClass("Present")?"0px":`calc(0.7em + ${o.outerHeight()}px)`;e.css("margin-top",d),o.width(t-(t<780?21.6:0)).css({left:`${a}px`});for(let e of $("section.Post p[data-latex]").filter(":visible").removeClass("AutoScroll"))e.scrollWidth>e.clientWidth&&$(e).addClass("AutoScroll");aspect()}function loadHash(e){clearFeed();let t=location.hash;"#~"==t&&(t=""),loadFeed(t?t.slice(1):"home",!e)}function collapse(e){let t=e.altKey&&e.ctrlKey;if(e.target!=e.currentTarget)return;let a=$(e.currentTarget).next("div.Collapse");if(!t||a.is(":hidden")){a.fadeToggle(250,(()=>{drawChevrons(),layoutWidth()}));let e=collapse.toggled,t=loadFeed.current,o=$("div.Collapse").index(a[0]),d=e[t].indexOf(o);-1==d?e[t].push(o):e[t].splice(d,1)}t&&slideShow(a)}teacher.mode=!1,collapse.toggled={};let siteData={};function msg(e,t){e||(e="Unable to load page.");let a=$("body"),o=$(window),d=$("<div>").addClass("Message").html(e).appendTo(a),l=(o.width()-d.outerWidth())/2;d.css({left:`${l}px`}),d.fadeIn(500),setTimeout((()=>{d.fadeOut(1500),setTimeout((()=>{d.remove()}),1600)}),t||2500)}$(window).on("resize",layoutWidth).on("popstate",loadHash);