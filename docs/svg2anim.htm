<section class="Post NoPrintIcon" data-icon="svg">   
<h2 class="Collapse">Animations</h2><div class="Collapse">

<p>Here’s a simple animation of Earth and Venus orbiting the Sun. Below that is the function that creates the animation using <code>SVG2</code>. We will go through the function line by line to see how it works.</p>
<p class="Center"><svg id="Orbits"></svg></p>

<pre class="Code" data-echo="js">function draw() {
    <span class="Comment">// Create the animation</span>
    let svg = new SVG2("#Orbits", {lrbt: [-1.1, 1.1, -1.1, 1.1], scale: 160});

    <span class="Comment">// Draw the Sun at the origin</span>
    SVG2.style(svg.circle("12"), "yellow");

    <span class="Comment">// Define a function to make random angles</span>
    let angle = () => 360 * Math.random();

    <span class="Comment">// Draw and animate Earth</span>
    let earth = svg.group("#0065fe");
    earth.circle("7", [1, 0]);
    earth.config({animated: true, theta: angle(), omega: 20});

    <span class="Comment">// Draw and animate Venus</span>
    let venus = svg.group("lightgrey");
    venus.circle("6", [0.72, 0]);
    venus.config({animated: true, theta: angle(), omega: 32});

    <span class="Comment">// Set background to black and pause/resume on mouse click</span>
    svg.$.css("background-color", "black").on("click", () => svg.toggle());

    <span class="Comment">// Start the animation</span>
    svg.play();
}</pre>

<p>The first line creates the animation to run in an <code>&lt;svg&gt;</code> identified by <code>id = "Orbits"</code>:</p>
<pre class="CodeScroll">let svg = new SVG2("#Orbits", {lrbt: [-1.1, 1.1, -1.1, 1.1], scale: 160})</pre>
<p>We want the Earth to orbit at a radius of 1, so we’ve defined the coordinate system to go a little past 1 on both the positive and negative sides of both axes. The <code>scale</code> sets the overall size of the animation.</p>
<p>Next we draw a yellow circle with a radius of 12 pixels to represent the Sun. We do not need to specify the coordinates of the centre since the default position will be the origin.</p>
<pre class="CodeScroll">SVG2.style(svg.circle("12"), "yellow")</pre>
<p>Now we define a function that chooses a random angle between 0 and 360:</p>
<pre class="CodeScroll">let angle = () => 360 * Math.random()</pre>
<p>Earth will be drawn as a light blue circle with a radius of 7 pixels. In <code>SVG2</code>, animation is done on <code>&lt;g&gt;</code> elements, so we will create a group, and then add the circle to it:</p>
<pre class="CodeScroll">let earth = svg.group("#0065fe");
earth.circle("7", [1, 0]);</pre>
<p>The circle is positioned 1 unit away from the origin so that it will orbit with the desired radius of 1. The animation is accomplished with the next line:</p>
<pre class="CodeScroll">earth.config({animated: true, theta: angle(), omega: 20})</pre>
<p>We call the group’s <code>config</code> method to set its <code>animated</code> property to <code>true</code>. This signals to <code>SVG2</code> that it needs to animate the group when the animation is playing. We use our <code>angle</code> function to rotate the Earth to a random angle. We do not need to specify a <code>pivot</code> point because this defaults to the origin.</p>
<p>Omega (<i>ω</i>) is a Greek letter often used to represent <em>angular speed</em>. Setting this to 20 means that when the animation is running, the <code>theta</code> value will automatically change at a rate of 20° per second.</p>
<p>We repeat these last three lines for Venus, changing the fill colour, circle size, orbital radius, and angular speed:</p>
<pre class="CodeScroll">let venus = svg.group("lightgrey");
venus.circle("6", [0.72, 0]);
venus.config({animated: true, omega: 32, theta: angle()});</pre>

<p>We now use <code>jquery</code> to give our <code>&lt;svg&gt;</code> element a black background, and an event listener for mouse clicks.</p>
<pre class="CodeScroll">svg.$.css("background-color", "black").on("click", () => svg.toggle())</pre>
<p>The expression <code>svg.$</code> refers to a <code>jquery</code> collection containing only our <code>&lt;svg&gt;</code> element. We are handling mouse click events by running <code>svg.toggle()</code>, which switches the animation between playing and paused.</p>
<p>The final line automatically starts the animation when the <code>draw</code> function finishes:</p>
<pre class="CodeScroll">svg.play()</pre>

<p>In addition to the <code>shift</code>, <code>theta</code> and <code>omega</code> properties, motion of animated groups can be controlled with the <code>vel</code> (velocity), <code>acc</code> (acceleration) and <code>alpha</code> (angular acceleration) properties. The <code>shift</code>, <code>vel</code>, and <code>acc</code> values are 2-arrays specifying both <span class="TeX">x</span> and <span class="TeX">y</span> components.</p>

</div></section>

<section class="Post NoPrintIcon" data-icon="svg">   
<h2 class="Collapse">Customizing the Animation</h2><div class="Collapse">
<p>Now we will add a timer to the animation by adding a few extra lines to the <code>draw</code> function from the previous example.</p>
<pre class="Code" data-echo="js">let textStyle = ["mono", 20, "bold", "white"];
let timer = svg.text("0.00 yr", [1, 1, "topright"], 0, textStyle).config({animated: true});

timer.beforeupdate = function() {
    let years = svg.frameCount / (360 / earth.omega * svg.frameRate);
    this.config({text: `${years.toFixed(2)} yr`});
}
</pre>
<p>Here is the animation now:</p>
<p class="Center"><svg id="Timer"></svg></p>

<p>We add an <code>SVG2text</code> instance to the drawing, using the variable <code>timer</code> to reference it, and call its <code>config</code> method to set its <code>animated</code> property to <code>true</code>. Initially, the text reads <code>"0.00 yr"</code>.</p>
<pre class="Code" data-echo="js">let textStyle = ["mono", 20, "bold", "white"];
let timer = svg.text("0.00 yr", [1, 1, "topright"], 0, textStyle).config({animated: true});</pre>

<p>Next we define a function to update the timer, and set it as the <code>timer.beforeupdate</code> property. <code>SVG2</code> will run this function prior to drawing each frame of the animation.</p>

<p>Next we calculate how many “years” have passed based on how many frames of the animation have been drawn.</p>
<pre class="Code" data-echo="js">let years = svg.frameCount / (360 / earth.omega * svg.frameRate);</pre>

<p>We calculate <code>360 / earth.omega</code> to find out how many seconds it takes Earth to complete one orbit; if <code>earth.omega</code> is 20 degrees per second, a full 360° will take 18 seconds. If we multiply by <code>svg.frameRate</code>, this will tell us how many frames are drawn over one complete Earth orbit. The default frame rate is 60 frames per second, so 18 seconds corresponds to 1080 frames. Dividing the total number of frames drawn, <code>svg.frameCount</code>, by this number gives us the number of years to display on the timer.</p>

<p>We update the time shown on the timer by calling its <code>config</code> method:</p>
<pre class="Code" data-echo="js">this.config({text: `${years.toFixed(2)} yr`});</pre>

<p>By defining the <code>beforeupdate</code> function using the <code>function</code> keyword, the <code>this</code> keyword will refer to <code>timer</code> within the scope of the function. If the function is defined using the <code>=></code> operator instead, <code>this</code> will refer to the browser <code>window</code> object.</p>

</div></section>

<section class="Post NoPrintIcon" data-icon="svg">   
<h2 class="Collapse">Updating</h2><div class="Collapse">

<p>You can define a <code>beforeupdate</code> and an <code>afterupdate</code> function for each animated group, and for the <code>SVG2</code> instance itself.</p>

<p>The <code>SVG2</code> instance keeps an array of animated items that can be referenced as <code>svg.items</code>. As each frame of the animation is drawn, the <code>SVG2</code> instance’s <code>beforeupdate</code> function is called first. Then the first animated item’s <code>beforeupdate</code> function is called. This item’s kinematics properties (<code>theta</code>, <code>omega</code>, <code>shift</code>, <code>vel</code>) are then updated, and then its <code>afterupdate</code> function is called. Then the same procedure is applied to each of the remaining animated items in order. Finally, the <code>SVG2</code> instance’s <code>afterupdate</code> function is called.</p>

<p>Items are appended to the array whenever their <code>animated</code> property is set to <code>true</code>, and removed when set to <code>false</code>. This will determine the order in which the <code>beforeupdate</code> and <code>afterupdate</code> functions are called.</p>

</div></section>


<script type="text/javascript" data-init="draw">

loadFeed.draw1 = () => {
    // Create the animation
    let svg = new SVG2("#Orbits", {lrbt: [-1.1, 1.1, -1.1, 1.1], scale: 160});

    // Draw the Sun at the origin
    SVG2.style(svg.circle("12"), "yellow");

    // Define a function to make random angles
    let angle = () => 360 * Math.random();

    // Draw and animate Earth
    let earth = svg.group("#0065fe");
    earth.circle("7", [1, 0]);
    earth.config({animated: true, theta: angle(), omega: 20});

    // Draw and animate Venus
    let venus = svg.group("lightgrey");
    venus.circle("6", [0.72, 0]);
    venus.config({animated: true, theta: angle(), omega: 32});

    // Set background to black and pause/resume on mouse click
    svg.$.css("background-color", "black").on("click", () => svg.toggle());

    // Start the animation
    return svg.play();
}

loadFeed.draw2 = () => {
    let svg = new SVG2("#Timer", {lrbt: [-1.1, 1.1, -1.1, 1.1], scale: 160});
    SVG2.style(svg.circle("12"), "yellow");
    let angle = () => 360 * Math.random();
    let earth = svg.group("#0065fe");
    earth.circle("7", [1, 0]);
    earth.config({animated: true, theta: angle(), omega: 20});
    let venus = svg.group("lightgrey");
    venus.circle("6", [0.72, 0]);
    venus.config({animated: true, theta: angle(), omega: 32});

    let textStyle = ["mono", 20, "bold", "white"];
    let timer = svg.text("0.00 yr", [1, 1, "topright"], 0, textStyle).config({animated: true});

    timer.beforeupdate = function() {
        let years = svg.frameCount / (360 / earth.omega * svg.frameRate);
        this.config({text: `${years.toFixed(2)} yr`});
    }

    svg.$.css("background-color", "black").on("click", () => svg.toggle());
    return svg.play();
}

loadFeed.draw = () => {
    for (let i=1;i<3;i++) loadFeed[`draw${i}`]();
}

loadFeed.data = {
    title: `SVG2 Tutorial 3: Animation`,
    up: "home", prev: "svg2img", next: "svg2graph"
}

</script>
