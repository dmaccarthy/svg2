/*(c) 2023-2025 [github.com/dmaccarthy/svg2]*/function jeval(t){return JSON.parse(`{"a": ${t}}`).a}function jeval_frac(t){return jeval((t=t.split("/"))[0])/(t.length>1?jeval(t[1]):1)}function click_cycle(t,e,...i){t.cycleStatus=e,$(t).click((e=>{let r=e.ctrlKey,s=i.length;t.cycleStatus+=r?-1:1,t.cycleStatus<0?t.cycleStatus=s-1:t.cycleStatus>=s&&(t.cycleStatus=0);let n=r?0:t.cycleStatus;for(;n<=t.cycleStatus;)i[n++]()}))}Array.prototype.item=function(t){return this[t<0?t+this.length:t]},click_cycle.toggle=(t,e,...i)=>{let r;try{r=t instanceof SVG2?t:null}catch(t){}for(let s of i){let i=r?r.$.find(`.Toggle${s}`):$(t[s]);e?i.fadeIn():null==e?i.fadeToggle():i.fadeOut()}};const range=function*(t,e,i){for(null==e&&(e=t,t=0),i||(i=t<e?1:-1);i>0&&t<e||i<0&&t>e;)yield t,t+=i};function qs_args(t,e){let i={};for(let[t,r]of new URLSearchParams(e||location.search))i[t]=r;return t?i[t]:i}function item_aspect(t,e){let i=jeval_frac((t=$(t)).attr("data-aspect"));if(e){t.css({width:""});let e=Math.round(t.height()*i);e!=t.width()&&t.width(e)}else{t.css({height:""});let e=Math.round(t.width()/i);e!=t.height()&&t.height(e)}}function aspect(t){let e=$("[data-aspect]");for(let i=0;i<e.length;i++)item_aspect(e[i],t)}const random_string=(t,e)=>{let i="";for(2==e&&(i=random_string(1),t--);t--;){let t=Math.floor((e?62:52)*Math.random());t=(t<26?65:t<52?97:48)+t%26,i+=String.fromCharCode(t)}return i};function*_zip(t,e,i){let r=t instanceof Array,s=e instanceof Array,n=r?t.length:e.length;for(let a=0;a<n;a++){let n=r?t[a]:t,l=s?e[a]:e;yield i?new RArray(n,l):[n,l]}}function zip(t,e,i){return[..._zip(t,e,i)]}function unzip(t,e){let i=t[0].length,r=new Array(i);for(let t=0;t<r.length;t++)r[t]=e?new RArray:[];for(let e=0;e<t.length;e++)for(let s=0;s<i;s++)r[s].push(t[e][s]);return r}function unicode_to_base64(t){let e=(new TextEncoder).encode(t);return btoa(String.fromCharCode(...e))}function katex_render(t,e){t=$(t||".TeX").removeClass("TeX");for(let i of t){let t=$(i),r=t.text();t.attr("data-latex",r);let s={displayMode:t.is("p, div, .Display"),throwOnError:!1};e&&Object.assign(s,e),katex.render(r,i,s)}katex_render.hideEqNum&&$("[data-latex]:is(p, div) .eqn-num").hide()}async function mjax_render(t,e){t=$(t||".TeX").addClass("TeX_Pending").removeClass("TeX");let i=[];for(let r of t){let t=$(r),s=t.text();t.attr("data-latex",s),f=e?t=>$(t):t=>$(t).find("svg"),i.push(MathJax.tex2svgPromise(s).then((e=>t.removeClass("TeX_Pending").html(f(e)[0]))))}return new Promise((async t=>{for(let t=0;t<i.length;t++)await i[t];t()}))}async function mjax_wait(t){for(;!MathJax.typesetPromise;)await SVG2.sleep(t||50);return new Promise((t=>t()))}async function mjax_svg(t){return MathJax.tex2svgPromise(t).then((t=>$($(t).find("svg")[0])))}async function mjax_url(t){return mjax_svg(t).then((t=>"data:image/svg+xml;base64,"+unicode_to_base64(t[0].outerHTML)))}function mjax_img(t){return mjax_url(t).then((t=>$("<img>").attr({src:t})))}async function load_img(t){return new Promise((e=>{let i=new Image;i.addEventListener("load",(()=>e(i))),i.src=t}))}async function blobify(t,...e){return new Promise((i=>{if(t instanceof Blob)t.save=blobify._save,i(t);else if(t.toBlob)t.toBlob((t=>{t.save=blobify._save,i(t)}),...e);else{let r=new Blob([t],{type:e.length?e[0]:"text/plain"});r.save=blobify._save,i(r)}}))}function img2canvas(t,e){if(e||(e=1),!(e instanceof Array)){let i=$(t);e=[Math.round(e*i.width()),Math.round(e*i.height())]}let[i,r]=e;if(i*r==0)throw"Image has a dimension of 0";let s=$("<canvas>").attr({width:i,height:r})[0];return s.getContext("2d").drawImage(t,0,0,i,r),s}async function load_one_blob(t,e){return new Promise(((i,r)=>{fetch(t).then((t=>t.blob().then((s=>{if(t.ok)if(e){const t=new FileReader;t.onloadend=t=>i(t.target.result),t.readAsDataURL(s)}else i(s);else r(s)}))))}))}async function _load_blobs(t,...e){let i={},r={};for(let s of e)r[s]=load_one_blob(s,t).then((t=>i[s]=t),(()=>i[s]=null));for(let t of e)await r[t];return new Promise((t=>{t(i)}))}async function load_blobs(...t){return _load_blobs(0,...t)}async function load_dataURLs(...t){return _load_blobs(1,...t)}function code_echo(t,e){let i=t.text();if(e){let r=t.attr("data-echo"),s=r.split(".").pop();r==s&&(r=random_string(12,1)+"."+s),"html"!=s&&"htm"!=s||(-1==i.search("</body>")&&(i=`<body>\n${i}\n</body>`),-1==i.search("</head>")&&(i=`${code_echo.head}\n${i}\n`),-1==i.search("</html>")&&(i=`${code_echo.html}\n${i}\n</html>`)),blobify(i,blobify.mime(s)).then((t=>t.save(2==e?r:null)))}else navigator.clipboard.writeText(i).then((()=>msg("Text copied to clipboard")),(()=>msg("Unable to copy text")))}katex_render.hideEqNum=!0,renderTeX=mjax_render,blobify._save=function(t){let e=URL.createObjectURL(this);t?$("<a>").attr({href:e,download:t})[0].click():window.open(e),URL.revokeObjectURL(e)},blobify.mime=t=>{let e={html:"text/html",htm:"text/html",js:"text/javascript",css:"text/css",csv:"text/csv",py:"text/python",svg:"image/svg+xml",png:"image/png",jpg:"image/jpeg",webp:"image/webp",json:"application/json",xml:"application/xml",pdf:"application/pdf",zip:"application/zip"}[t.split(".").pop().toLowerCase()];return e||"text/plain"},code_echo.html='<!DOCTYPE html>\n<html lang="en-ca">',code_echo.head='<head>\n<meta charset="utf8"/>\n<meta name="viewport" content="width=device-width, initial-scale=1"/>\n<title>HTML Document</title>\n<link rel="shortcut icon" type="image/svg+xml" href="https://upload.wikimedia.org/wikipedia/commons/6/61/HTML5_logo_and_wordmark.svg"/>\n</head>';const pi=Math.PI,DEG=pi/180,RAD=180/pi,twoPi=2*pi,halfPi=pi/2,quarterPi=pi/4;class RArray extends Array{static add(...t){let e=new RArray,i=t[0].length;for(let r=0;r<i;r++){let i=0;for(let e=0;e<t.length;e++)i+=t[e][r];e.push(i)}return e}static convert(...t){let e=[];for(let i of t)e.push(new RArray(...i));return e}sum(){let t=this.length,e=0;if(t){e=this[0];for(let i=1;i<t;i++)e+=this[i]}return e}minmax(){let t=this[0],e=t;for(let i=0;i<this.length;i++)this[i]<t&&(t=this[i]),this[i]>e&&(e=this[i]);return{min:t,max:e}}extend(t){return this.push.apply(this,t),this}remove(t,e){let i=!0;for(;i;){let r=this.indexOf(t);r>=0&&this.splice(r,1),-1!=r&&e||(i=!1)}return this}times(t){let e=t instanceof Array,i=new RArray;for(let r=0;r<this.length;r++)i.push(this[r]*(e?t[r]:t));return i}neg(){return this.times(-1)}plus(t){return RArray.add(this,t)}minus(t){let e=new RArray;for(let i=0;i<this.length;i++)e.push(this[i]-t[i]);return e}dot(t){let e=0;for(let i=0;i<this.length;i++)e+=this[i]*t[i];return e}mag(){return Math.sqrt(this.dot(this))}dir(){if(2!=this.length)throw"ValueError: operation applies only to arrays of length 2";return atan2(this[1],this[0])}tr(t,e){t||(t=4);let i=$("<tr>"),r=[this.mag(),this.dir(),this[0],this[1]];for(let s of r)e&&(s*=e),i.append($("<td>").html(s.toPrecision(t)));return i}}function xy_limits(...t){let e=new RArray(0,0),i=[e];for(let r of t)e=e.plus(r),i.push(e);let[r,s]=unzip(i,!0);return r=r.minmax(),s=s.minmax(),{x:r,y:s,center:[(r.min+r.max)/2,(s.min+s.max)/2],size:[r.max-r.min,s.max-s.min]}}function*fn_eval(t,e){for(let i of e)yield t(i)}function uniform(t,e){return t+(e-t)*Math.random()}function randint(t,e){return null==e&&(e=t,t=0),t+Math.floor((e+1-t)*Math.random())}function shuffle(t){for(let e=t.length-1;e>0;e--){let i=randint(e+1);[t[e],t[i]]=[t[i],t[e]]}}function arrow_points(t,e){e||(e={});let i=(e.angle?e.angle:35)*DEG,r=e.tail?e.tail:t/14;r<0&&(r*=-t);let s=e.head?e.head:4*r,n=Math.cos(i),a=Math.sin(i),l=r/2,o=-s*n,h=o-r*a,c=s*a,u=c-r*n,d=h-(l-u)*n/a;(d<h||2==e.shape)&&(d=h),u<l&&(u=l);let f=RArray.convert([0,0],[o,c],[h,u],[d,l],[-t,l],[-t,-l],[d,-l],[h,-u],[o,-c]);(e.shape||c<l)&&(f.splice(8,1),f.splice(1,1)),t/=2;for(let e=0;e<f.length;e++)f[e][0]+=t;if(e.double){let t=Math.floor(f.length/2),e=f.slice(0,t),i=t=>{let[e,i]=f[t];return new RArray(-e,i)};for(let r=0;r<t;r++)e.push(i(t-1-r));t=e.length-2,i=t=>{let[i,r]=e[t];return new RArray(i,-r)};for(let r=t;r>0;r--)e.push(i(r));f=e}return f}function star_points(t,e,i){return i||(i=3*e/7),[...fn_eval((r=>vec2d(r%2?i:e,90*(1+2*r/t))),range(0,2*t))]}function sq(t){return t*t}function root(t,e){return Math.pow(t,1/(null==e?2:e))}function sin(t){return Math.sin(t*DEG)}function cos(t){return Math.cos(t*DEG)}function tan(t){return Math.tan(t*DEG)}function asin(t){return Math.asin(t)*RAD}function acos(t){return Math.acos(t)*RAD}function atan(t){return Math.atan(t)*RAD}function atan2(t,e){return Math.atan2(t,e)*RAD}function hypot(t,e){return Math.sqrt(t*t+e*e)}const log=(t,e)=>(t=Math.log(t),e?t/Math.log(e):t),vec2d=(t,e,i)=>(i||(e*=DEG),new RArray(t*Math.cos(e),t*Math.sin(e))),vec=(...t)=>new RArray(...t),adjust_angle=(t,e,i)=>{for(null==e&&(e=0),null==i&&(i=e+360);t<e;)t+=360;for(;t>=i;)t-=360;return t};class Segment{constructor(t,e,i,r){null==i&&(i=t,r=e,t=e=0);let s=i-t,n=r-e,a=Math.sqrt(s*s+n*n),l=new RArray(s/a,n/a),o=Math.atan2(n,s),h=this;Object.assign(this,{point1:new RArray(t,e),point2:new RArray(i,r),length:a,rad:o,deg:o*RAD,slope:l[1]/l[0],midpoint:new RArray(t+s/2,e+n/2),unitVector:l,vector:new RArray(s,n),normal:new RArray(-l[1],l[0]),point:i=>new RArray(t+l[0]*i,e+l[1]*i),params:(i,r)=>{let s=(i-t)*l[0]+(r-e)*l[1],n=(t-i)*l[1]+(r-e)*l[0];return new RArray(s,n)},closest:(i,r)=>h.point((i-t)*l[0]+(r-e)*l[1])})}static point_slope(t,e,i,r){let[s,n]=Math.abs(i)==1/0?new RArray(0,i<0?-e:e):new RArray(1,i).times(e/hypot(1,i)),[a,l]=r?new RArray(-s/2,-n/2).plus(t):t;return new Segment(a,l,a+s,l+n)}}function _SSS(t,e,i){return acos((i*i-t*t-e*e)/(-2*t*e))}function SSS(t,e,i){return[_SSS(e,i,t),_SSS(t,i,e),_SSS(t,e,i)]}function SAS(t,e,i){let r=root(t*t+i*i-2*t*i*cos(e)),s=_SSS(i,r,t);return[s,r,180-(s+e)]}function ASA(t,e,i){let r=180-(t+i);return[(e/=sin(r))*sin(t),r,e*sin(i)]}function SSA(t,e,i,r){let s=asin(e*sin(i)/t);r&&(s=180-s);let n=180-(i+s);if(n>=0)return[root(t*t+e*e-2*t*e*cos(n)),n,s]}function quad_form(t,e,i){return[(-e+root(e*e-4*t*i))/(2*t),(-e-root(e*e-4*t*i))/(2*t)]}const transform=(t,...e)=>{let i=t.angle?t.angle:0;t.deg&&(i*=DEG);let r=Math.cos(i),s=Math.sin(i),n=0,a=0;t.center&&(n=t.center[0],a=t.center[1]);let l=n,o=a;t.shift&&(l+=t.shift[0],o+=t.shift[1]);let h=[];for(let t=0;t<e.length;t++){let i=e[t][0]-n,c=e[t][1]-a;h.push(new RArray(i*r-c*s+l,i*s+c*r+o))}return h};function lin_reg_xy(t,e){let i=t.length;if(e.length!=i)throw"Dimension error";t=new RArray(...t),e=new RArray(...e);let r=t.sum(),s=e.sum(),n=(i*t.dot(e)-r*s)/(i*t.dot(t)-r*r),a=(s-n*r)/i;return{m:n,b:a,fn:t=>n*t+a}}function exp_reg_xy(t,e){let i=e.length,r=new Array(i);for(let t=0;t<i;t++)r[t]=Math.log(e[t]);let s=lin_reg_xy(t,r),n=Math.exp(s.b),a=s.m;return{a:n,k:a,fn:t=>n*Math.exp(a*t)}}function pwr_reg_xy(t,e){let i=t.length,r=new Array(t),s=new Array(i);for(let n=0;n<i;n++)r[n]=Math.log(t[n]),s[n]=Math.log(e[n]);let n=lin_reg_xy(r,s),a=Math.exp(n.b);return i=n.m,{a:a,n:i,fn:t=>a*Math.pow(t,i)}}function lin_reg(...t){return lin_reg_xy(...unzip(t))}function exp_reg(...t){return exp_reg_xy(...unzip(t))}function pwr_reg(...t){return pwr_reg_xy(...unzip(t))}function gcf(t,e){let i=parseInt(t),r=parseInt(e);if(t!=i||e!=r||isNaN(i)||isNaN(r)||t<1||e<1)throw"Invald argument";if([t,e]=[Math.min(i,r),Math.max(i,r)],e%t==0)return t;let s=1,n=2;for(;2*n<=t;)t%n==0&&e%n==0&&(s=n),n++;return s}function lcm(t,e){return Math.round(t/gcf(t,e)*e)}class SVG2g{constructor(t,e){t&&(this.element=e?$(e)[0]:document.createElementNS(SVG2.nsURI,"g"),this.element.graphic=this,this.$=$(this.element),this.$.appendTo(e?e.$:t.$),this.svg=t.svg,this._pivot=new RArray(0,0),this._shift=new RArray(0,0),this._vel=new RArray(0,0),this._acc=new RArray(0,0),this.thetaMode=1,this._theta=0,this.omega=0,this.alpha=0)}find(t,e){let i=this.$.find(t)[e||0];return i?i.graphic:null}find_all(t){let e=[];for(let i of this.$.find(t))i.graphic instanceof SVG2g&&e.push(i.graphic);return e}config(t){for(let e in t)this[e]=t[e];return this.update_transform()}addClass(...t){return this.$.addClass(...t),this}css(...t){return SVG2.style(this.$,...t),this}ralign(t,e){let i,r,s=this.svg,n=this.element.getBBox(),[a,l]=[n.width,n.height];a*l==0&&console.warn("Aligning group with 0 width or height:",this),[a,l,i,r]=this.rect_xy([a.toFixed(2),l.toFixed(2)],t),"x"==e?r=n.y:"y"==e&&(i=n.x);let[o,h]=new RArray(i,r).minus([n.x,n.y]);return this.shift_by([o/s.scale[0],h/s.scale[1]]),this.update_transform()}align(t,e,i){let r=this.element.getBBox(),[s,n]=[r.width,r.height];s*n==0&&console.warn("Aligning group with 0 width or height:",this),"number"==typeof t&&(t=[t,t]),null==i&&(null==e?e=i=.5:"string"==typeof e&&([e,i]={top:[.5,0],bottom:[.5,1],left:[0,.5],right:[1,.5]}[e]));let a=null==e,l=null==i,o=this.svg.p2a(r.x+(a?0:e)*s,r.y+(l?0:i)*n).plus(this._shift);return o=this._cs(t).minus(o),a&&(o[0]=0),l&&(o[1]=0),this._shift=this._shift.plus(o),this.update_transform()}get pivot(){return this._pivot}get shift(){return this._shift}get vel(){return this._vel}get acc(){return this._acc}get theta(){return this._theta}set pivot(t){this._pivot=new RArray(...this._cs(t))}set shift(t){this._shift=new RArray(...this._cs(t))}set vel(t){this._vel=new RArray(...this._cs(t))}set acc(t){this._acc=new RArray(...this._cs(t))}set theta(t){if(this.thetaMode){for(;t>=360;)t-=360;for(;t<0;)t+=360}this._theta=t}shift_by(t){return this._shift=this._shift.plus(this._cs(t)),this.update_transform()}clip_path(t,e){let i=this.$,r=$(document.createElementNS(SVG2.nsURI,"clip_path")).attr({id:t});r.appendTo(this.svg.defs[0]),e?r.html(i.html()):i.children().appendTo(r);let s=i.attr("transform");return s&&r.children().attr({transform:s}),r}clip(t){return this.$.attr({"clip-path":`url(#${t})`}),this}get parent(){let t=this.$.parent().closest("g, svg");return t.length?t[0].graphic:null}gpath(){let t=this.parent,e=[this];return t?t.gpath().concat(e):e}coord_from_parent(t){let e=this.theta*this.svg.angleDir;return t=this._shift.neg().plus(t),transform({angle:e,deg:!0,center:this._pivot},t)[0]}coord_to_parent(t){let e=this.theta*this.svg.angleDir;return transform({angle:-e,deg:!0,center:this._pivot,shift:this._shift},t)[0]}coord_to_svg(t){let e=this;for(;e.parent;)t=e.coord_to_parent(t),e=e.parent;return t}coord_from_svg(t){let e=this.gpath();for(let i=1;i<e.length;i++)t=e[i].coord_from_parent(t);return t}update_transform(){let t=this.svg,e=this.theta*t.angleDir,[i,r]=t.scale.times(this.shift),s=e=>e.toFixed(t.decimals),n=i||r?`translate(${s(i)} ${s(r)})`:"";if(e){let[i,r]=t.a2p(...this.pivot);n+=` rotate(${s(e)} ${s(i)} ${s(r)})`}return n=n.trim(),n.length?this.$.attr("transform",n):this.$.removeAttr("transform"),this}update(t){let e=this.alpha,i=this.omega;e&&(this.omega+=t*e,i+=t/2*e),i&&(this.theta=this.theta+t*i);let r=this._vel,s=this._acc;if(r||s){let e=s.times(t/2);r=r.plus(e),this._vel=r.plus(e),this._shift=this._shift.plus(r.times(t))}return this.update_transform()}get animated(){return this.svg.items.indexOf(this)>-1}set animated(t){SVG2.set_animated(this,t)}create_child(t,e){return $(document.createElementNS(SVG2.nsURI,t)).attr(e||{}).appendTo(this.element)}group(...t){let e=new SVG2g(this.svg,this.create_child("g"));return t&&e.css(...t),e}scaled(t){return new SVG2scaled(this.svg,this.create_child("g"),t)}_px(t,e){return Math.abs("string"==typeof t?parseFloat(t):t*this.svg.scale[e])}_cs(t){let[e,i]=null==t?[0,0]:t,r=this.svg,[s,n]=r.scale;return"string"==typeof e&&(e=parseFloat(e)/Math.abs(s)),"string"==typeof i&&(i=parseFloat(i)/Math.abs(n)),new RArray(e,i)}circle(t,e,i){let r=i?$($(i)[0]):this.create_child("circle"),s=this.svg,n=t=>t.toFixed(s.decimals),a=`${n(2*(t=s._px_size(t)))}`,[l,o,h,c]=this.rect_xy([a,a],e);return r.attr({r:n(t),cx:n(h+l/2),cy:n(c+o/2)})}ellipse(t,e,i){let r=i?$($(i)[0]):this.create_child("ellipse"),s=this.svg,n=t=>t.toFixed(s.decimals),a=this._px(t[0],0),l=this._px(t[1],1),[o,h,c,u]=this.rect_xy([n(2*a),n(2*l)],e);return r.attr({rx:n(a),ry:n(l),cx:n(c+o/2),cy:n(u+h/2)})}static _anchor(t){return null==t&&(t=[0,0]),4==t.length?t:t[0]instanceof Array?[...t[0],...t[1]]:[...t,.5,.5]}rect_xy(t,e){let[i,r,s,n]=SVG2._anchor(e),a=this.svg,l=this._px(t[0],0),o=this._px(t[1],1);return[i,r]=a.a2p(...this._cs([i,r])),[l,o,i-s*l,r-n*o]}rect(t,e,i){let r=i?$($(i)[0]):this.create_child("rect"),s=t=>t.toFixed(this.svg.decimals),[n,a,l,o]=this.rect_xy(t,e);return r.attr({width:s(n),height:s(a),x:s(l),y:s(o)})}async image_promise(t,e){t=new URL(t,location.href).href;let i=e?$($(e)[0]):this.create_child("image");return load_img(t).then((e=>{let r=$(e).appendTo("body"),s={width:r.width(),height:r.height()};return r.remove(),[i.attr({href:t,x:0,y:0}),s]}))}_img_size(t,e){t||(t={scale:1});let i=t.scale;if(i){let[r,s]=[e.width,e.height];r&&s||console.warn("Sizing image with a dimension of 0"),t=[(i*r).toFixed(2),(i*s).toFixed(2)]}else t instanceof Array||(t=[t,t]);return t}async image(t,e,i,r){return this.image_promise(t,r).then((t=>{let r=t[1];t=t[0],e=this._img_size(e,r);let[s,n,a,l]=this.rect_xy(e,i),o=t=>t.toFixed(this.svg.decimals);return t.attr({width:o(s),height:o(n),x:o(a),y:o(l)})}))}async mjax(t,e,i,r){let s=this.group(),n=s.create_child("image");return null==e&&(e={scale:1}),e.scale&&(e={scale:e.scale/32}),r&&(t=`\\color{${r}}{${t}}`),mjax_svg(t).then((t=>{t.appendTo("body");let r=t[0].getBBox();t.remove(),e=this._img_size(e,r);let[a,l,o,h]=this.rect_xy(e,i),c=t=>t.toFixed(this.svg.decimals),u="data:image/svg+xml;base64,"+unicode_to_base64(t[0].outerHTML);return n.attr({href:u,width:c(a),height:c(l),x:c(o),y:c(h)}),s}))}plot(t,e,i,r){let s=this.group(".Plot","black@1","#0065fe"),n=this.svg,a=t=>t.toFixed(n.decimals);r&&(r*=n.angleDir),t instanceof Array||(t=zip(t.x,t.y));for(let l of t){let t;if(i?(t=s.group().config({pivot:l}),t.image(i,e,l),t=t.$):t=e instanceof Array?s.rect(e,l):s.circle(e,l),r){let[e,i]=n.a2p(...l);t.attr({transform:`rotate(${a(r)} ${a(e)},${a(i)})`})}}return s}label(t,e,i){let r,s,n=this.group(),a=e instanceof Array,l=i instanceof Array;if(t instanceof Array)[r,s]=t,[r,s]=a?[this._cs([0,r])[1],this._cs([0,s])[1]]:[this._cs([r,0])[0],this._cs([s,0])[0]];else if("number"==typeof t){let e=t;t=a?t=>t.toFixed(e):(t,i)=>i.toFixed(e)}let o=r||s,h=a?e.length:i.length;for(let c=0;c<h;c++){let h=a?e[c]:e,u=l?i[c]:i,[d,f]=this._cs([h,u]);if(o)l?a||n.line([d+r,f],[d+s,f]):n.line([d,f+r],[d,f+s]);else{let e=n.text(t(h,u,c),[d,f]);0==parseFloat(e.html())&&e.addClass("Zero")}}return o?n.css("black@1").$.addClass("Ticks Tick"+(l?"Y":"X")):(n.css("text",15).$.addClass("Labels Label"+(l?"Y":"X")),l&&n.css({"text-anchor":"end"})),n}tick_label(t,e,i,r,s){let n=["number","string"].indexOf(typeof r)>=0,a=e instanceof Array;return r&&this.label(n?[0,r]:r,e,i),null==s&&(s=0),a?this.label(t,e,s):this.label(t,s,i),this}poly(t,e){let i={points:this.svg.pts_str(t)};return $(e)[0]instanceof SVGElement?$(e).attr(i):this.create_child(e?"polygon":"polyline",i)}_cs_size(t){return"string"==typeof t?parseFloat(t)/this.svg.unit:t}_px_size(t){return"string"==typeof t?parseFloat(t):t*this.svg.unit}star(t,e,i){let r=star_points(t,this._cs_size(e),null==i?null:this._cs_size(i));return this.poly(r,1)}arrow(t,e,i){return new SVG2arrow(this,t,e,i)}locus(t,e,i){return new SVG2locus(this,t,e,i)}path(t){return new SVG2path(this,t)}line(t,e,i){let r=i?$($(i)[0]):this.create_child("line"),s=this.svg,n=t=>t.toFixed(s.decimals),[a,l]=s.a2p(...this._cs(t)),[o,h]=s.a2p(...this._cs(e));return r.attr({x1:n(a),y1:n(l),x2:n(o),y2:n(h)})}chevron(t,e,i){null==i&&(i="7");let r=i.ratio;r?i=i.size:r=1;let s=this.svg.scale,n=-(i=this._px_size(i))/s[0],a=r*i/s[1],l=this.group();return l.poly([[n,a],[0,0],[n,-a]]),l.config({shift:t,theta:e||0})}ray(t,e,i,...r){let s=this.group();s.$.addClass("Ray"),s.line(t,e);let n=s.seg=new Segment(...t,...e),a=this.svg,l=n.length;0==r.length&&(r=[.5]);for(let t of r)s.chevron(n.point(t*l),a.adjust_angle(n.deg),i);return s}grid(t,e,i){let r=this.group("grid");this._grid(r,t,e),this._grid(r,e,t,1);let s=r.$.addClass("Grid");return(null==i||i)&&s.find(".Axis").appendTo(s),r}_grid(t,e,i,r){if(3==e.length){let[s,n,a]=e,[l,o]=i;[s,n]=[Math.min(s,n),Math.max(s,n)],[l,o]=[Math.min(l,o),Math.max(l,o)],a<0&&(a=-a);let h=a/1e3;for(n+=h;s<=n;){let e=r?[[l,s],[o,s]]:[[s,l],[s,o]],i=t.line(...e);Math.abs(s)<h&&i.addClass("Axis").css({stroke:"black","stroke-width":"1px"}),s+=a}}}text(t,e,i){let r=this.svg,s=i?$($(i)[0]):this.create_child("text"),n=t=>t.toFixed(r.decimals),[a,l]=r.a2p(...this._cs(e));return s.attr({x:n(a),y:n(l)}).html(t)}gtext(t,e,i){e instanceof Array||(e=[e]);let r=this.group(...e);return r.text(t),r.ralign(i)}symb(...t){let e=this.group(".Symbol"),i=t=>"number"==typeof t?`${size}px`:t;for(let[r,s,n]of t){let t=0;"number"==typeof s&&([t,s]=[s,null]);let a=e.text(r,n);4&t&&a.css({"font-size":"60%"}),1&t&&a.css(SVG2._style.bold),2&t&&a.css(SVG2._style.ital),s&&(s.size&&a.css({"font-size":i(s.size)}),s.css&&a.css(s.css))}return e}ctext(...t){let e=[];for(let[i,r,s]of t){null==s&&(s={}),"string"==typeof s&&(s={css:s});let t=this.gtext(i,s.css?s.css:[],r);s.config&&t.config(s.config),e.push(t)}return e}ruler(t,e,i){"string"==typeof e&&(e=parseFloat(e)/Math.abs(this.svg.scale[1])),i=Object.assign({big:10,offset:0,tickSmall:.25,tickBig:.5},i);let r=this.group(".Ruler"),s=r.rulerLength=e*(t+2*i.offset),n=i.width?i.width:r.rulerLength/25;r.rect([s,n]);let a=e*i.offset-s/2;n/=2;for(let s=0;s<=t;s++)r.line([a,-n],[a,n*(2*(s%i.big?i.tickSmall:i.tickBig)-1)]),a+=e;return r}cylinder(t,e){let i=this.group(".Cylinder"),r=new RArray(t[0],0),s=r.neg().minus([0,e]),n=-1==i.svg.angleDir?2:0;return i.path(r).ver(-e).arc_to(s,t,n).ver(0).arc_to(r,t).close().update(),i.ellipse(t),i}pm(t,e,i){let r=this.group();return e&&r.rect([t/6,t],i),r.rect([t,t/6],i),r}stickman(t){let e=this.group(".Stickman","none","black@3"),i=t/8;e.circle(i,[0,7*i]),e.line([0,6*i],[0,3*i]);let r=1.2*i;e.poly([[-r,0],[0,3*i],[r,0]]);let s=new RArray(0,5*i);return i*=1.5,e.poly([s.plus(vec2d(i,uniform(150,210))),s,s.plus(vec2d(i,uniform(-30,30)))]),e}edot(t,e){e||(e=1);let i=.25*e,r=[[-e,i],[-e,-i]];if(-1==t)t=2;else if(r=[[-e,0],[0,e],[e,0],[0,-e],[-e,0],[0,e],[e,0],[0,-e]],t>4)for(let e=0;e<t-4;e++)r[e][1-e%2]=i,r[e+4][1-e%2]=-i;let s=this.group({stroke:"none"});for(let i=0;i<t;i++)s.circle(.125*e,r[i]);return s}graph(t){let e=this.svg,i=t.x,r=t.y;if(t.grid){let[i,r]=t.grid,[s,n,a,l]=e.lrbt;s=i*Math.round(s/i),n=i*Math.round(n/i),a=r*Math.round(a/r),l=r*Math.round(l/r),this.grid([s,n,i],[a,l,r],t.appendAxes)}if(i||r){let t=this.group(".AxisTitle","text"),s=t=>{let s=(t?r:i).title[1];return s instanceof Array||(s=t?[s,e.center[1]]:[e.center[0],s]),s};if(i){let e=[0,i.y?i.y:0];i.tick&&(this.tick_label(i.dec?i.dec:0,[...range(...i.tick)],0,i.tickSize?i.tickSize:"-6"),this.find("g.LabelX").config({shift:i.shift}).shift_by(e),this.find("g.TickX").shift_by(e)),i.title&&t.group().shift_by(e).text(i.title[0],s(0))}if(r){let e=[r.x?r.x:0,0];r.tick&&(this.tick_label(r.dec?r.dec:0,0,[...range(...r.tick)],r.tickSize?r.tickSize:"-6"),this.find("g.LabelY").config({shift:r.shift}).shift_by(e),this.find("g.TickY").shift_by(e)),r.title&&t.group().config({theta:90,shift:s(1)}).shift_by(e).text(r.title[0])}}let s=t.data;if(s){let t=this.group(".Series"),e=[];for(let i of s)if(i.plot)e.push(t.plot(...i.plot));else{let r=t.group(".Locus","#0065fe@2","none");if(e.push(r),i.connect){let t=i.connect;t instanceof Array||(t=zip(t.x,t.y)),r.poly(t)}else i.locus&&r.locus(...i.locus)}this.series=e}return this}error_bar_y(t,e,i,r,s){r=this._cs_size(r);let n=this.group().addClass("ErrorBar");return s?(n.line([e,t],[i,t]),t-=r/2,n.line([e,t],[e,t+r]),n.line([i,t],[i,t+r])):(n.line([t,e],[t,i]),t-=r/2,n.line([t,e],[t+r,e]),n.line([t,i],[t+r,i])),n}error_bar_x(t,e,i,r){return this.error_bar_y(i,t,e,r,1)}tip_to_tail(t,e){null==e&&(e={});let i=this.group(".TipToTail2D"),r=new RArray(0,0),s=Object.assign({tail:"7"},e);for(let e of t){let t=r,n=t.plus([e[0],0]);r=r.plus(e),(e[0]||e[1])&&(e[0]&&i.arrow({tail:t,tip:n},s).css(".Component"),e[1]&&i.arrow({tail:n,tip:r},s).css(".Component"),i.arrow({tail:t,tip:r},s))}if(t.length>1){if(r[0]&&r[1]){let t=[r[0],0];i.arrow({tail:[0,0],tip:t},s).$.addClass("Component Resultant"),i.arrow({tail:t,tip:r},s).$.addClass("Component Resultant")}i.arrow({tail:[0,0],tip:r},s).$.addClass("Resultant")}return i}energy_flow(t){SVG2.style(this.circle(t.radius),"none","#0065fe@3");let e=this.group("text",24);for(let r of t.labels){let[t,s,n,a]=r,l="$"==(i=t).charAt(0)?i.substring(1):SVG2.eq[i]?SVG2.eq[i]:null;l&&"$"!=t.charAt(0)&&console.log(t,l),n||(n="#0065fe"),l?this.mjax(l,{scale:1},s,n):e.gtext(t,n,s)}var i;e=this.group("arrow");for(let e of t.arrows){let[t,i,r,s,n]=e;n||(n="#0065fe");let a=this.arrow(t,{tail:"6"}).css(n).config({theta:r,shift:i});s&&(s instanceof Array||(s=[s,[t>0?"-6":"6","12"]]),a.label(...s).css({stroke:"none"}))}return this}coil(t,e,i,r,s){let n=this.group();n.$.addClass("Coil");let a=i?n.scaled([-1,1]):n,[l,o]=t;e||(e=15),r||(r=o/e/4),a.rect(t);for(let i=0;i<e+.5;i++){let s=(o-6*r)*(i-e/2)/e;a._turn(t[0],r,i==e?2:3).config({shift:[0,s]}).$.addClass("Wire"),0!=i&&i!=e||(s+=r*(i?2:-2),a.line([l/2,s],[l/2+2*r,s]).addClass("Wire"))}return null==s&&(s=.7*r),s&&a.circle(s),n}_turn(t,e,i){let r=this.group();null==i&&(i=0),t/=2;let s=r.path([t,1&i?4*e:2*e]);return 1&i&&s.arc([t,3*e],-90),s.line_to([-t,-2*e]),2&i&&s.arc([-t,-e],90,2),s.update(),r}}class SVG2scaled extends SVG2g{constructor(t,e,i){super(t,e);let r=this.svg,s=t=>t.toFixed(r.decimals),[n,a]=r.a2p(0,0);n=s(n),a=s(a);let l=s(-n),o=s(-a),[h,c]=this.scale="number"==typeof i?[i,i]:i;this.$.attr({transform:`translate(${n} ${a}) scale(${h} ${c}) translate(${l} ${o}) `})}get pivot(){return new RArray(0,0)}get shift(){return new RArray(0,0)}get theta(){return 0}update_transform(){return this}coord_to_parent(t){let[e,i]=this.scale;return new RArray(t[0]*e,t[1]*i)}coord_from_parent(t){let[e,i]=this.scale;return new RArray(t[0]/e,t[1]/i)}}class SVG2arrow extends SVG2g{constructor(t,e,i,r){super(t),this.$.addClass("Arrow"),this._poly=this.poly([],1),this.reshape(e,i,r)}reshape(t,e,i){let r=this.svg,[s,n]=(t=>{if("number"==typeof t)return[[-t/2,0],[t/2,0]];{let e=t.tail,i=t.tip;if(null==e&&(e=[0,0]),null==i){let r=t.angle;i=vec2d(t.length,r||0).plus(e)}return[e,i]}})(t);s=r._cs(s),n=r._cs(n);let a=this.seg=new Segment(...s,...n);i?"string"==typeof i&&(i=["tail","center","tip"].indexOf(i)-1):i=0,this.pivot=a[-1==i?"point1":1==i?"point2":"midpoint"];let l=t=>Math.abs("string"==typeof t?parseFloat(t):t*r.scale[1]),o={};e&&(o=Object.assign(o,e),o.tail&&(o.tail=l(o.tail)),o.head&&(o.head=l(o.head))),a=new Segment(...r.a2p(...s),...r.a2p(...n));let h=arrow_points(a.length,o);h=transform({angle:a.deg,deg:!0,shift:a.midpoint},...h);for(let t=0;t<h.length;t++)h[t]=r.p2a(...h[t]);return this.poly(h,this._poly),this}label(t,e){return this.gtext(t,["text","none@"],this.seg.midpoint.plus(this._cs(e)))}}class SVG2locus{constructor(t,e,i,r){let s=this.svg=t.svg;this.eq=e,i||(i=[s.lrbt[0],s.lrbt[1]]),this.param=i.length>2?i:i.concat([s.$.width()/3]),this.args=r,this.$=t.create_child("polyline",{}).addClass("Locus"),this.css("none"),this.element=this.$[0],this.element.graphic=this,this.update()}css=SVG2g.prototype.css;config(t){for(let e in t)this[e]=t[e];return this}update(){let t=this.svg,e=t.time,[i,r]=[this.eq,this.args],[s,n,a]=this.param;a=(n-s)/Math.round(a),n+=a/2;let l=[];for(;s<=n;){let t=i(s,e,r);if(!1===t)return;l.push("number"==typeof t?[s,t]:t),s+=a}return this.$.attr({points:t.pts_str(l)}),this}get animated(){return this.svg.items.indexOf(this)>-1}set animated(t){SVG2.set_animated(this,t)}}class SVG2path{constructor(t,e){this.g=t,this.svg=t.svg,this.$=t.create_child("path",{}),this.d="",this.move_to(null==e?[0,0]:e)}move_to(t,e){let i=this.svg,r=t=>t.toFixed(i.decimals),[s,n]=t;return this.x=s,this.y=n,[s,n]=i.a2p(...t),this.d+=`${e||"M"} ${r(s)} ${r(n)} `,this}line_to(t){return this.move_to(t,"L")}lines_to(...t){for(let e of t)this.line_to(e);return this}hor(t){let e=this.svg;return this.x=t,t=e.a2p(t,0)[0],this.d+=`H ${(t=>t.toFixed(e.decimals))(t)} `,this}ver(t){let e=this.svg;var i;return this.y=t,t=e.a2p(0,t)[1],this.d+=`V ${i=t,i.toFixed(e.decimals)} `,this}arc_to(t,e,i,r){let s,n,a=this.svg,l=t=>t.toFixed(a.decimals);e instanceof Array?[s,n]=e:s=n=e,s=a._px(s,0),n=a._px(n,1),r=r?l(r*a.angleDir):"0";let[o,h]=t;this.x=o,this.y=h,[o,h]=a.a2p(o,h);let c=0,u=0;return i&&(c=1&i,u=2&i?1:0),this.d+=`A ${l(s)} ${l(n)} ${r} ${c} ${u} ${l(o)} ${l(h)} `,this}arc(t,e,i){let r=(t=new RArray(...t)).minus([this.x,this.y]).neg(),s=r.mag(),n=r.dir();null==i&&(i=Math.max(e,n)-Math.min(e,n)>=180?1:0,e<n&&(i+=2));let a=t.plus([s*cos(e),s*sin(e)]);return this.arc_to(a,s,i)}curve_to(t,e,i){let r=this.svg,s=t=>t.toFixed(r.decimals),[n,a]=t;this.x=n,this.y=a,[n,a]=r.a2p(n,a);let[l,o]=r.a2p(...e),[h,c]=r.a2p(...i);return this.d+=`C ${s(l)} ${s(o)}, ${s(h)} ${s(c)}, ${s(n)} ${s(a)} `,this}quad_to(t,e){let i=this.svg,r=t=>t.toFixed(i.decimals),[s,n]=t;this.x=s,this.y=n,[s,n]=i.a2p(s,n);let[a,l]=i.a2p(...e);return this.d+=`Q ${r(a)} ${r(l)}, ${r(s)} ${r(n)} `,this}close(){return this.d+="Z ",delete this.x,delete this.y,this}update(){return this.$.attr({d:this.d.trim()})}}class SVG2 extends SVG2g{constructor(t,e){super(),this.svg=this,this.element=$(t).filter("svg")[0],t=this.$=$(this.element).attr("xmlns",SVG2.nsURI),this.element.graphic=this,this.items=[],this.decimals=2;let i=e.margin?e.margin:0;"number"==typeof i&&(i=[i,i,i,i]);let r=e.lrbt,s=e.scale;!s||s instanceof Array||(s=[s,s]);let[n,a]=e.size?e.size:s&&r.length>3?[s[0]*(r[1]-r[0])+i[0]+i[1]+1,s[1]*(r[3]-r[2])+i[2]+i[3]+1]:[t.width(),t.height()];if(n=Math.abs(Math.round(n)),a=Math.abs(Math.round(a)),t.attr({width:n,height:a,"data-aspect":n/a,viewBox:`0 0 ${n} ${a}`}),r){let[t,e,s,l]=i;r.length<4&&(r=SVG2.auto_lrbt(n-i[0]-i[1],a-i[2]-i[3],...r)),this.coords_by_map([t,a-1-s],[r[0],r[2]],[n-1-e,l],[r[1],r[3]])}else r=[0,n-1,0,a-1],this.coords_by_map([0,0],[0,0],[1,1],[1,1]),this.p2a=this.a2p=(t,e)=>new RArray(t,e);this.lrbt=r;let l=e.grid;if(l){let[t,i]="number"==typeof l?[l,l]:l,s=t*Math.round(r[0]/t),n=i*Math.round(r[2]/i),a=this.grid([s,r[1],t],[n,r[3],i],e.appendAxes);e.noAxes&&a.$.find(".Axis").removeClass("Axis").css(SVG2._style.grid)}this.playing=!1,this.frameRate=60,this.frameCount=0,this.timeFactor=1,this.time=0}static async sleep(t){await new Promise((e=>setTimeout(e,t)))}static arr(t){return["→",5,[0,null==t?"20":t]]}get size(){let t=this.$;return[parseFloat(t.attr("width")),parseFloat(t.attr("height"))]}get url(){return"data:image/svg+xml;base64,"+unicode_to_base64(this.element.outerHTML)}static async cleanup_svg(t,e){let i=(t=$(t).removeAttr("class style"))[0].attributes,r=[];for(let t=0;t<i.length;t++){let e=i.item(t);"data"==e.name.split("-")[0]&&r.push(e.name)}for(let e of r)t.removeAttr(e);if(e){t.appendTo("body"),$(document.createElementNS(SVG2.nsURI,"rect")).prependTo(t).attr({x:0,y:0,width:t.width(),height:t.height(),style:`fill: ${e}`}),t.remove()}let s=[],n=[];for(let e of t.find("image")){let t=$(e).attr("href");"data:"!=t.substring(0,5)&&(n.push(e),s.push(t))}return load_dataURLs(...s).then((e=>{for(let t=0;t<s.length;t++){let i=e[s[t]];$(n[t]).attr({href:i})}return t[0]}))}static async svg_to_cv(t,e){return load_img("data:image/svg+xml;base64,"+unicode_to_base64(t.outerHTML)).then((t=>{let i=$(t).appendTo("body"),r=img2canvas(t,e);return i.remove(),r}))}async image_cv(t,e){return SVG2.cleanup_svg(this.element.outerHTML,e).then((e=>SVG2.svg_to_cv(e,t)))}async save(t){return SVG2.cleanup_svg(this.element.outerHTML).then((t=>blobify(t.outerHTML,"image/svg+xml"))).then((e=>e.save(t)))}async save_image(t,e,i){1==t&&(t=`${random_string(12,1)}.png`);let r=t?t.split(".").item(-1).toLowerCase():"png";return"jpg"==r&&(r="jpeg"),this.image_cv(e,i).then((t=>blobify(t,"image/"+r))).then((e=>e.save(t)))}get defs(){let t=this.$.find("defs");return 0==t.length&&(t=this.create_child("defs").prependTo(this.$)),t}get center(){let[t,e,i,r]=this.lrbt;return new RArray((t+e)/2,(i+r)/2)}clip_rect(t,e){null==t&&(t=0),t=this._cs(t instanceof Array?t:[t,t]).times(2);let i=this.group(),[r,s,n,a]=this.lrbt;return i.rect([Math.abs(s-r)+t[0],Math.abs(a-n)+t[1]],this.center),i.clip_path(e||"lrbt"),this}gradient(t,e,i,r,s,n,a){let l=(t,e)=>{let i=document.createElementNS(SVG2.nsURI,t);return null!=e&&$(i).attr(e),i},o=$(l("linearGradient",{id:t,x1:`${null==r?0:r}%`,x2:`${null==s?100:s}%`,y1:`${null==n?0:n}%`,y2:`${null==a?0:a}%`})).appendTo(this.defs[0]);return o.append(l("stop",{offset:"0%","stop-color":e})),o.append(l("stop",{offset:"100%","stop-color":i})),this}static create(t){return new SVG2(document.createElementNS(SVG2.nsURI,"svg"),t)}static auto_lrbt(t,e,i,r,s,n){if(null==n){let a=(e-1)*(r-i)/(t-1);null==s?s=-(n=a/2):n=s+a}return[i,r,s,n]}update_transform(){return this}coords_by_map(t,e,i,r){let[s,n]=new RArray(...r).minus(e),[a,l]=new RArray(...i).minus(t),o=a/s,h=l/n,c=this.scale=new RArray(o,h);this.unit=Math.sqrt((o*o+h*h)/2),this.angleDir=o*h<0?-1:1;let u=new RArray(-1/o,-1/h);t=new RArray(...t).minus(c.times(e)),this.a2p=(e,i)=>t.plus(c.times([e,i])),this.p2a=(e,i)=>t.minus([e,i]).times(u)}event_coords(t){let e=this.$,i=parseFloat(e.css("padding-left"))+parseFloat(e.css("border-left-width")),r=parseFloat(e.css("padding-top"))+parseFloat(e.css("border-top-width")),s=this.element.getBoundingClientRect(),n=new RArray(t.clientX-(s.x+i),t.clientY-(s.y+r));return n[0]*=parseFloat(e.attr("width"))/e.width(),n[1]*=parseFloat(e.attr("height"))/e.height(),{pixels:n,coords:this.p2a(...n)}}adjust_angle(t,e){let[i,r]=this.scale;return e&&(i=1/i,r=1/r),atan2(r*this.angleDir*sin(t),i*cos(t))}group(...t){let e=new SVG2g(this);return t&&e.css(...t),e}pts_str(t){let e="",i=t=>t.toFixed(this.decimals);for(let r=0;r<t.length;r++){let[s,n]=this.a2p(...this._cs(t[r]));e+=(e.length?" ":"")+`${i(s)},${i(n)}`}return e}static set_animated(t,e){let i=t.svg,r=i.items,s=r.indexOf(t);e?-1==s&&i.animate(t):s>-1&&r.splice(s,1)}animate(...t){for(let e of t)e.update||(e=$(e)[0].graphic),-1==this.items.indexOf(e)&&this.items.push(e);return this}unanimate(...t){let e=this.items;for(let i=e.length-1;i>=0;i--)t.indexOf(e[i])>-1&&e.splice(i,1);return this}update(t){clearTimeout(this._animate);let e=null==t;e&&(t=this.timeFactor/this.frameRate),this.beforeupdate&&this.beforeupdate.call(this);for(let e of this.items)try{e.beforeupdate&&e.beforeupdate(e),e.update(t),e.afterupdate&&e.afterupdate(e)}catch(t){console.warn(t)}this.time+=t,t=1e3/this.frameRate;let i=this._nextFrame-Date.now();return i<=0?(i=1,this._nextFrame=Date.now()+t-1):this._nextFrame+=t,e&&this.frameCount++,this.afterupdate&&this.afterupdate.call(this),this.playing&&(this._animate=setTimeout((()=>{this.update()}),i)),this}play(){return this.playing=!0,this._nextFrame=Date.now()+1e3/this.frameRate,this._fpsDebug&&(this._fpsDebug=[this.frameCount,Date.now()]),this.update()}pause(){if(clearTimeout(this._animate),this.playing=!1,this._fpsDebug){let[t,e]=this._fpsDebug;t=this.frameCount-t,e=(Date.now()-e)/1e3,console.log(`${t} frames / ${e} sec = ${t/e} fps`)}return this}toggle(){return this.playing?this.pause():this.play()}click_toggle(t,e,i){let r=[()=>click_cycle.toggle(this,!1,...range(t))];for(let e=0;e<t;e++)r.push((()=>click_cycle.toggle(this,!0,e)));if(click_cycle(this.element,null==i?-1:i,...r),e)for(let t=0;t<e;t++)this.$.trigger("click");return this}static async load(cb){let svgs=$("svg[data-svg2]"),pending={},ts=Date.now();for(let svg of svgs){let[url,id,args]=$(svg).attr("data-svg2").split("#");url=new URL(url,SVG2.url).href,svg.info=[url,id,args],null==pending[url]&&null==SVG2._cache[url]&&(pending[url]=fetch(`${url}?_=${ts}`).then((t=>t.text())).then(eval))}for(let t in pending)await pending[t];for(let t of svgs){let[e,i,r]=t.info;delete t.info;let s=`${e}#${i}`;if(r&&(s+=`#${r}`),$(t).removeAttr("data-svg2").attr("data-svg2x",s),r){try{r=jeval(r)}catch(t){console.warn(t)}r instanceof Array||(r=[r])}else r=[];try{SVG2._cache[e][i](t,...r)}catch(t){console.warn(t)}}return cb?cb():null}static cache_run(t,e,...i){return SVG2._cache[new URL(t,SVG2.url).href][e](...i)}static cache(t,e){SVG2._cache[new URL(t,SVG2.url).href]=e}static make_URL(t){return new URL(t,SVG2.url).href}static cached(t){return SVG2._cache[new URL(t,SVG2.url).href]}static vec_diag(t,e,i){let r=new SVG2(t,i);i||(i={});let s=r.tip_to_tail(e);if(i.shift&&s.config({shift:i.shift}),i.label){let[t,e,s,n]=i.label,[a,l,o,h]=r.lrbt;a=t*Math.ceil(a/t),o=t*Math.ceil(o/t);let c=i.tick;c?(r.tick_label(e,0,[...range(o,h+t/10,t)],c,s),r.tick_label(e,[...range(a,l+t/10,t)],0,c,n)):(r.label(e,s,[...range(o,h+t/10,t)]),r.label(e,[...range(a,l+t/10,t)],n))}s.$.appendTo(r.$);for(let t of"XY"){let e=r.find(`g.Label${t}`);e&&e.shift_by([0,"-5"])}return r.$.find(".Zero").hide(),-1==i.cycle?s.$.find(".Component").hide():i.cycle&&r.vec_cycle(s.$,e.length>1),s.$.find(".Arrow").css(SVG2._style.arrow),s.$.find(".Resultant").css({fill:"#0065fe"}),s.$.find(".Component").css({fill:"yellow"}),r}vec_cycle(t,e){return t.find(".Component").hide(),e?click_cycle(this.element,0,(()=>{t.find(".Component").fadeOut()}),(()=>{t.find(".Resultant").fadeOut(),t.find(".Component:not(.Resultant)").fadeIn()}),(()=>{t.find(".Component:not(.Resultant)").fadeOut(),t.find(".Component.Resultant").fadeIn()}),(()=>{t.find(".Resultant").fadeIn()})):this.$.on("click",(()=>t.find(".Component").fadeToggle())),this}static vec_diag_table(t,e,i,r){let s=$("<table>").addClass("VectorTable"),n=$("<thead>").appendTo(s),a=$("<tr>").appendTo(n),l="Δ"==t.charAt(0)?`\\Delta\\vec{\\bf ${t.substring(1)}}`:`\\vec{\\bf ${t}}`;for(let t of[`|${l}|`,"\\theta",`${l}_x`,`${l}_y`])a.append($("<th>").addClass("TeX").html(t));a=$("<tr>").appendTo(n);for(let t of[`\\sqrt{(${l}_x)^2 + (${l}_y)^2}`,`\\tan^{-1}\\frac{${l}_y}{${l}_x}`,`|${l}| \\cos\\theta`,`|${l}| \\sin\\theta`])a.append($("<th>").html($("<p>").html(t).addClass("TeX")));let o=$("<tbody>").appendTo(s),h=new RArray(0,0);for(let t of e)r&&(t=new RArray(...t).times(r)),h=h.plus(t),o.append(new RArray(...t).tr(i||4));return o.append(new RArray(...h).tr(i||4).addClass("Resultant")),renderTeX(n.find(".TeX")),s}static ebg(t,e,i,r,s){s=Object.assign({size:[512,384],width:.5,duration:0,unit:"J",margin:[32,4,44,16]},s);let n=r.length,a=new SVG2(t,{size:s.size,lrbt:[0,n,0,e],margin:s.margin});a.grid([0,n],[0,e,i]).grid([0,1,2],[0,e]);let l=[],o=a.group(".MJax");for(let t=0;t<n;t++){let e=r[t],i=e[2]?e[2]:"#0065fe";l.push(a.rect([s.width,1],[t+.5,1]).css({fill:i}));let n=e[0];SVG2.eq[n]&&(n=SVG2.eq[n]),o.mjax(n,{scale:1},[[t+.5,"-8"],[.5,0]],i)}if(a.config({data:r,options:s}),a.$.find("g.Grid line.Axis").appendTo(a.$),s.E&&a.line([0,s.E],[n,s.E]).addClass("TotalEnergy").css({stroke:"black","stroke-width":"2px"}),s.label){let[t,r,n]=s.label,l=a.label(t,r,[...range(0,e+i,n?n*i:i)]),o=s.yShift;l.shift_by([0,null!=o?o:"-6"]),s.unit&&l.text(s.unit,["6",e]).css({"text-anchor":"start"}),l.$.find(".Zero").removeClass("Zero"),l.$.find("text").css({"font-size":"16px"})}return a.beforeupdate=function(){let t=this.time,e=this.options;if(e.duration&&t>e.duration)this.pause(),this.time=e.duration;else{let i=0,r=0,s=e.width,n=l.length;e.duration&&(t/=e.duration);for(let e=0;e<n;e++){let n=this.data[e][1];if(!0===n)r+=1;else{let r="number"==typeof n?n:n(t);i+=r,a.rect([s,r],[e+.5,r/2],l[e])}}let o=(e.E-i)/r;for(let t=0;t<n;t++){!0===this.data[t][1]&&a.rect([s,o],[t+.5,o/2],l[t])}}},a.$.on("click",(()=>{a.time>=a.options.duration&&!a.playing?(a.time=0,a.update(0)):a.toggle()})),a.update(0)}static*spring_points(t,e,i,r,s){let n=new Segment(...t,...e),a=n.length;r||(r=a/10),s||(s=a/10);let l=(a-2*r)/(2*i),o=n.normal.times(s);yield n.point(0);let h=r;for(let t=0;t<=i;t++)yield n.point(h).plus(o.times(t?t%2?1:-1:0)),h+=(t?2:1)*l;yield n.point(a-r),yield n.point(a)}static style(t,...e){let i=t=>isNaN(t)?t:`${t}px`;for(let r of e){let e=["string","number"].indexOf(typeof r);-1==e?t.css(r):0==e?"."==r.charAt(0)?t.addClass(r.substring(1)):SVG2._style[r]?t.css(SVG2._style[r]):(r=r.split("@"),1==r.length?t.css({fill:r[0]}):(r[0]&&t.css({stroke:r[0]}),r[1]&&t.css({"stroke-width":i(r[1])}))):1==e&&t.css({"font-size":i(r)})}return t}}SVG2.nsURI="http://www.w3.org/2000/svg",SVG2._cache={},SVG2.load.pending=[],SVG2.url=location.origin,"http://localhost"!=SVG2.url.substring(0,16)&&(SVG2.url+="/sci/"),SVG2.sans="'Noto Sans', 'Open Sans', 'Droid Sans', Oxygen, sans-serif",SVG2.mono="Inconsolata, 'Droid Sans Mono', monospace",SVG2.symbol=SVG2.serif="'Noto Serif', 'Open Serif', 'Droid Serif', serif",SVG2._style={grid:{stroke:"lightgrey","stroke-width":"0.5px"},text:{"font-family":SVG2.sans,"font-size":"18px","text-anchor":"middle"},start:{"text-anchor":"start"},middle:{"text-anchor":"middle"},end:{"text-anchor":"end"},symbol:{"font-family":SVG2.symbol,"font-size":"18px","text-anchor":"middle"},arrow:{fill:"red",stroke:"black","stroke-width":"0.5px","fill-opacity":.8},ital:{"font-style":"italic"},bold:{"font-weight":"bold"},nostroke:{stroke:"none"},nofill:{fill:"none"},sans:{"font-family":SVG2.sans},serif:{"font-family":SVG2.serif},mono:{"font-family":SVG2.mono}},SVG2.eq={Ek:"E_k",Eg:"E_g"};